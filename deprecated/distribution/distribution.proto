syntax = "proto3";
option go_package = "models/distribution";

enum DistributionRoleCodeType {
    DISTRIBUTION_ROLECODE_NONE = 0;
    DISTRIBUTION_ROLECODE_MEMBER = 1;
    DISTRIBUTION_ROLECODE_AGENT = 2;
    DISTRIBUTION_ROLECODE_COMPANY = 3;
    DISTRIBUTION_ROLECODE_ADMIN = 4;
}

message Hierarchy {
    string upline = 1;
    string downline = 2;
    int32 portionOfProfit = 3;
    int32 uplinePortionOfProfit = 4;
    int32 minPortionOfProfit = 5;
    bool isCover = 6;
    double riskLimit = 7;


    DistributionRoleCodeType uplineRole = 8;
    DistributionRoleCodeType downlineRole = 9;


    repeated FuturesFee futuresFee = 10;
    double stockFee = 11;

    repeated string templateName = 12;
    repeated string template = 13;

    double interest = 15;
}

message FuturesFee {
    string exchangeCode = 1;
    string varietyCode = 2;
    double futuresFeePercent = 3;
    double futuresFeeCertain = 4;
}

message DistributionResponse {
    string message =  1;
}

message DownlineQuery {
    string upline = 1;
    DistributionRoleCodeType role = 2;
    int32 level = 3;
}

message DistributionAccountQuery {
    string account = 1;
    DistributionRoleCodeType role = 2;
}

message PortionOfProfit {
    string account = 1;
    int32 portionOfProfit = 2;
    int32 uplinePortionOfProfit = 3;
    int32 minPortionOfProfit = 4;
    double riskLimit = 5;
    bool isCover = 6;
}

message Downlines {
    repeated string downline = 1;
}

message LayerResponse{
    repeated int32 layer = 1;
}

message LevelResponse{
    int32 level = 1;
}

message DownlineCountResponse {
    int32 totalAgents = 1;
    int32 totalMembers = 2;
}

enum DistributionUserStatusType {
    Distribution_STATUS_NONE = 0;
    Distribution_ENABLED = 1;
    Distribution_SUPPRESSED = 2;
    Distribution_FREEZED = 3;
    Distribution_DISABLED = 4;
    Distribution_DISCARDED = 5;
    Distribution_DERIVED = 6;
}

message DownlineMemberQuery {
    string operator = 1;
    repeated string agents = 2;
    repeated string members = 3;
}

message DownlineAgentQuery {
    string operator = 1;
    repeated string agents = 2;
}

message GetReferrerRequest{
    string referee = 1;
}

message GetReferrerResponse{
    string referrer = 1;
}

message GetRefereeListRequest{
    string referrer = 1;
    int64 afterTime = 2;
    int64 beforeTime = 3;
    int32 hierarchyLength = 4;
}

message GetRefereeListResponse{
    repeated string refereeList = 1;
}

message DistributionChainReq{
    string account = 1;
    DistributionRoleCodeType role = 2;
    string product = 3;
    string country = 4;
    string exchangeCode = 5;
    string variety = 6;
}

message DistributionChainRes{
    string account = 1;
    string commissionChain = 2;
    string minCommissionChain = 3;
    string InterestChain = 4;
    string futuresfeeChain = 5;
    string stockfeeChain = 6;
    string cryptofeeChain = 7;
    string warrantfeeChain = 8;
    string cfdfeeChain = 9;
}
message GetUserInterestRequest{
    string Account = 1;
}

message GetUserInterestResponse{
    double basicInterest = 1;
    double deltaInterest = 2;
}


message PortionOfProfitResponse {
    string message =  1;
    int32 beforePortionOfProfit = 2;
    bool beforeIsCover = 3; // 包底
}

message UplinePortionOfProfitResponse {
    string message =  1;
    bool beforeIsCover = 2; // 包底
    int32 beforeUplinePortionOfProfit = 3;
}

message MinPortionOfProfitResponse {
    string message =  1;
    int32 beforeMinPortionOfProfit = 3;
}

message RiskLimitResponse {
    string message =  1;
    double beforeRiskLimit = 2;
}

message AgentTemplateReq{
    string account = 1;
    repeated string templateName = 2;
    repeated string template = 3;
    repeated string templateId = 4;
}

message AgentTemplateResponse{
    string account = 1;
    repeated string templateName = 2;
    repeated string template = 3;
    repeated string templateId = 4;
}

message GetCurrentFeeSettingReq{
    string account = 1;
}

message GetCurrentFeeSettingResponse{
    string currentFeeSetting = 1;
}

message ModifyAgentFeeSettingReq{
    string account = 1;
    string feeSetting = 2;

}
message ModifyAgentFeeSettingResponse{
    string message = 1;
}

message GetMemberFeeReq{
    string account = 1;
    string countryCode = 2;
    string exchangeCode = 3;
    string varietyCode = 4;
    int32 productType = 5;
}

message GetMemberFeeResponse{
    double fee = 3;
}

message MemberDefaultSettingReq{
    string account = 1;
    string feeSetting = 2;
    int32 uplineProfitOfShare = 3;
    string availableProduct = 4;

}
message MemberDefaultSettingResponse{
    string account = 1;
    string feeSetting = 2;
    int32 uplineProfitOfShare = 3;
    string availableProduct = 4;
}

message DistributionEmpty{}

message DeleteUserRequest{
    string account = 1;
}

message GetCompanyInterestFeeSettingReq {
}

message GetCompanyInterestFeeSettingRes {
    Interest interest = 1;
    Fee fee = 2;
    Portion portion = 3;
}

message Interest {
    repeated LoanInterest loanInterest = 1;
    repeated DepositInterest depositInterest = 2;
    repeated ForexOvernightInterest forexOvernightInterest = 3;
}

message Fee {
    repeated StockWarrantFee stockWarrantFee = 1;
    repeated CompanyFuturesFee futuresFee = 2;
    repeated CryptoCFDFee cryptoCFDFee = 3;
}

message Portion {
    repeated MinPortion minPortion = 1;
}

message LoanInterest {
    double min = 1;
    double max = 2;
    double monthlyInterest = 3;
    bool isPortion = 4;
}

message DepositInterest {
    string country = 1;
    double monthlyInterest = 2;
    bool isPortion = 3;
    bool isOpen = 4;
}

message ForexOvernightInterest {
    string product = 1;
    double buyPointValue = 2;
    double sellPointValue = 3;
    bool isPortion = 4;
}

message StockWarrantFee {
    string productType = 1;
    string country = 2;
    double fee = 3;
    bool isPortion = 4;
}

message CompanyFuturesFee {
    string country = 1;
    string exchange = 2;
    double oil = 3;
    double bond = 4;
    double energy = 5;
    double forex = 6;
    double indexs = 7;
    double preciousMetal = 8;
    double farmProduct = 9;
    bool isPortion = 10;
}

message CryptoCFDFee {
    string productType = 1;
    string country = 2;
    double fee = 3;
    bool isPortion = 4;
}

message MinPortion {
    double companyMinPortion = 1;
}

message ModifyCompanyInterestFeeSettingReq {
    string kind = 1;
    string category = 2;
    repeated LoanInterest loanInterests = 3;
    repeated DepositInterest depositInterests = 4;
    repeated ForexOvernightInterest forexOvernightInterests = 5;
    repeated StockWarrantFee stockWarrantFees = 6;
    repeated CompanyFuturesFee futuresFees = 7;
    repeated CryptoCFDFee cryptoCFDFees = 8;
    repeated MinPortion minPortions = 9;
}

message ModifyCompanyInterestFeeSettingRes {
}

message ModifyUserInterestReq{
    string account = 1;
    double interest = 2;

}
message ModifyUserInterestRes{
    string message =  1;
    double beforeInterest = 2;

}

message GetCountryExchangeVCReq{
}

message GetCountryExchangeRes{
    repeated string countries =  1;
    repeated string varietyCode = 2;
    repeated CountryExchanges countryExchange = 3;
    repeated ExchangeType exchangeType = 4;
}

message CountryExchanges{
    string country = 1;
    repeated string exchanges = 2;
}

message ExchangeType{
    int32 exchangeType = 1;
    repeated string exchanges = 2;
}

message DownlineMemberWithUserIdQuery {
    string operator = 1;
    repeated string agents = 2;
    repeated string members = 3;
}

message DownlineMemberByInfoQuery {
    string operator = 1;
    string phone = 2;
    string mail = 3;
    string idNumber = 4;
}

message DownlineAgentWithUserIdQuery {
    string operator = 1;
    repeated string agents = 2;
}

message DownlinesWithUserId {
    repeated DownlineWithUserId downline = 1;
}

message DownlineWithUserId{
    string account = 1;
    string userId = 2;
}

message GetPromotionReferrerReq {
    string referee = 1;
}

message GetPromotionReferrerRes {
    string referrer = 1;
}

message ModifyIsCoverReq{
    string account = 1;
    bool IsCover = 2;
}

message ModifyIsCoverRes{
    string message = 1;
}

service DistributionService {
    rpc CreateMember(Hierarchy) returns (DistributionResponse) {};
    rpc CreateAgent(Hierarchy) returns (DistributionResponse) {};
    rpc GetDownlines(DownlineQuery) returns (Downlines) {};
    rpc GetDownlineMembers(DownlineMemberQuery) returns (Downlines) {};
    rpc GetDownlineAgents(DownlineAgentQuery) returns (Downlines) {};
    rpc GetAvailableLevelOfAgent(DownlineQuery) returns (LayerResponse) {};
    rpc GetAgentAbsLevel(DistributionAccountQuery) returns (LevelResponse) {};
    rpc GetDirectUpline(DistributionAccountQuery) returns (Hierarchy) {};
    rpc GetPortionOfProfit(DistributionAccountQuery) returns (PortionOfProfit) {};
    rpc GetDownlineCount(DistributionAccountQuery) returns (DownlineCountResponse) {};
    rpc GetReferrer(GetReferrerRequest) returns(GetReferrerResponse){};
    rpc GetRefereeList(GetRefereeListRequest) returns(GetRefereeListResponse){};
    rpc GetPromotionReferrer(GetPromotionReferrerReq) returns (GetPromotionReferrerRes){};
    rpc GetDistributionChain(DistributionChainReq) returns(DistributionChainRes){};
    rpc GetUserInterest(GetUserInterestRequest) returns(GetUserInterestResponse){};

    rpc ModifyPortionOfProfit(Hierarchy) returns (PortionOfProfitResponse) {};
    rpc ModifyUplinePortionOfProfit(Hierarchy) returns (UplinePortionOfProfitResponse){};
    rpc ModifyMinPortionOfProfit(Hierarchy) returns (MinPortionOfProfitResponse){};
    rpc ModifyRiskLimit(Hierarchy) returns (RiskLimitResponse){};

    rpc DeleteMember(DeleteUserRequest) returns (DistributionEmpty){};
    rpc DeleteAgent(DeleteUserRequest) returns (DistributionEmpty){};

    rpc CreateAgentFeeTemplate(AgentTemplateReq) returns(AgentTemplateResponse){}
    rpc ModifyAgentFeeTemplate(AgentTemplateReq) returns(AgentTemplateResponse){}
    rpc DeleteAgentFeeTemplate(AgentTemplateReq) returns(AgentTemplateResponse){}

    rpc GetAgentFeeTemplate(AgentTemplateReq) returns(AgentTemplateResponse){};

    rpc GetCurrentFeeSetting(GetCurrentFeeSettingReq) returns(GetCurrentFeeSettingResponse){};

    rpc ModifyAgentFeeSetting(ModifyAgentFeeSettingReq) returns(ModifyAgentFeeSettingResponse){};
    rpc GetMemberFee(GetMemberFeeReq) returns(GetMemberFeeResponse){};

    rpc CreateMemberDefaultSetting(MemberDefaultSettingReq) returns(MemberDefaultSettingResponse){};
    rpc ModifyMemberDefaultSetting(MemberDefaultSettingReq) returns(MemberDefaultSettingResponse){};
    rpc GetMemberDefaultSetting(MemberDefaultSettingReq) returns(MemberDefaultSettingResponse){};

    rpc GetCompanyInterestFeeSetting(GetCompanyInterestFeeSettingReq) returns (GetCompanyInterestFeeSettingRes){};
    rpc GetCompanyLoanInterestSetting(GetCompanyInterestFeeSettingReq) returns (GetCompanyInterestFeeSettingRes){};
    rpc ModifyCompanyInterestFeeSetting(ModifyCompanyInterestFeeSettingReq) returns (ModifyCompanyInterestFeeSettingRes){};

    rpc ModifyUserInterest(ModifyUserInterestReq) returns(ModifyUserInterestRes){};

    rpc GetCountryExchangeVC(GetCountryExchangeVCReq) returns(GetCountryExchangeRes){};


    rpc GetDownlineMembersWithUserId(DownlineMemberWithUserIdQuery) returns (DownlinesWithUserId) {};
    rpc GetDownlineAgentsWithUserId(DownlineAgentWithUserIdQuery) returns (DownlinesWithUserId) {};
    rpc GetDownlineMembersByInfo(DownlineMemberByInfoQuery) returns (DownlinesWithUserId) {};


    rpc ModifyIsCover(ModifyIsCoverReq) returns(ModifyIsCoverRes){};
}
